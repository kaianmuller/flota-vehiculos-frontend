<div class="page">
    <button *ngIf="!select" id="filter" pButton icon="fas fa-filter" (click)="op.toggle($event)" pTooltip="Filtros" [style]="activeFiltersStyle()"></button>
    <div class="p-field">
        <div class="field-out">
            <div class="p-field">
            <span *ngIf="itemTarget" class="p-input-icon-right">
                    <i  [class]="itemTarget?'fas fa-times':''" (click)="itemTarget = null;sendItem(null);inputSearchText=''"></i>
                    <input id="select-input" type="text" [value]="itemTarget[selectHeader[0]]"  [style]="itemTarget?{'background-color':'lightgreen'}:{}" pInputText   pTooltip="Eliminar" readonly>    
            </span>
            <span *ngIf="!itemTarget" class="p-input-icon-right">
            <i  [class]="inputSearchText?'fas fa-times':''" (click)="inputSearchText = '';setQuerySearch();sendQuery()"></i>
            <input id="search-input" type="text" [value]="inputSearchText" pInputText (blur)="!inTable?showTable=false:true" (keyup.enter)="items.length == 1?sendItem(items[0]):true" (keyup.escape)="showTable=false;inputSearchText=''"  (keyup)="setInputSearchText($event)" pTooltip="Buscar" autocomplete="off">    
            </span>
            <div class="table" *ngIf="select && showTable && inputSearchText && selectHeader" (mouseenter)="inTable = true" (mouseleave)="inTable = false">
                <p-table #table [value]="items" [scrollable]="true" scrollHeight="200px">
                <ng-template pTemplate="header">
                    <tr>
                        <th [style]="{'max-width':maxWidthRow,'max-height':maxHeightRow,'padding-right':'5px'}" *ngFor="let h of selectHeader">{{firstUpperCase(h)}}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr (click)="sendItem(item)" [style]="setBackgroundFirstItem()">
                        <td [style]="{'max-width':maxWidthRow,'max-height':maxHeightRow,'padding-right':'5px'}" *ngFor="let h of selectHeader">{{item[h]}}</td>
                    </tr>
                </ng-template>
            </p-table>
        </div> 
        </div>
    </div>
    <p-overlayPanel #op>
        <ng-template pTemplate>
            <div class="panel">
                <div class="panel-title">
                    <label>Filtros</label>
                    <button pButton icon="fas fa-eraser" pTooltip="Vaciar filtros" (click)="resetFilters()"></button>
                </div>
                <div *ngFor="let e of enums">
                    <div class="panel-field" #enum>
                        <label>{{firstUpperCase(e.key)}}: </label>
                        <select (change)="setQueryEnum($event,e.key)">
                            <option value="">select</option>
                            <option *ngFor="let k of e.entries.keys;index as i" [value]="e.entries.values[i]" [selected]="e.entries.values[i] == queryFilter[e.key].value">{{e.entries.keys[i]}}</option>
                        </select>
                    </div>
                </div>
                <div *ngFor="let n of numbers">
                    <div class="panel-field">
                        <label>{{firstUpperCase(n.key)}}: </label>
                        <input class="small-number" type="number" [value]="queryFilter[n.key].min" placeholder="min" (blur)="setQueryNumberMin($event,n.key)">
                        <input class="small-number" type="number" [value]="queryFilter[n.key].max" placeholder="max" (blur)="setQueryNumberMax($event,n.key)">
                    </div>
                </div>
                <div *ngFor="let d of dates">
                    <div class="panel-field">
                        <label>{{firstUpperCase(d.key)}}: </label>
                        <div class="small-date">
                            <label>Desde:</label>
                            <input type="date" [value]="queryFilter[d.key].from" (blur)="setQueryDateFrom($event,d.key)">
                        </div>
                        <div class="small-date">
                            <label>Hasta:</label>
                            <input type="date" [value]="queryFilter[d.key].to" (blur)="setQueryDateTo($event,d.key)">
                        </div>
                    </div>
                </div>
                <div>
                    <button id="apply-button" pButton label="Aplicar" icon="fas fa-check" pTooltip="Aplicar filtros" (click)="sendQuery();op.hide()"></button>
                </div>
            </div>
        </ng-template>
    </p-overlayPanel>
</div>
